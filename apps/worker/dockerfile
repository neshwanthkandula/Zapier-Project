# apps/sweeper/Dockerfile
FROM node:20-alpine

WORKDIR /app

# Copy package files
COPY package*.json ./
COPY turbo.json ./
COPY apps/worker/package.json ./apps/worker/
COPY packages/db/package.json ./packages/db/

# Install dependencies
RUN npm install --prefer-offline --no-audit

# Copy source code
COPY apps/worker/ ./apps/worker/
COPY packages/db/ ./packages/db/

RUN npx prisma generate --schema=packages/db/prisma/schema.prisma

# Build the worker
RUN cd apps/worker && npm run build

CMD ["node", "apps/worker/dist/index.js"]